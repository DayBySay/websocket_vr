<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <title>websocket vr</title>
        <script type="text/javascript" src="/socket.io/socket.io.js"></script>
        <script src="https://aframe.io/releases/0.4.0/aframe.min.js"></script>
        <script type="text/javascript">
            var socket = io.connect();

            socket.on("move_box", function(data){
                move_box(data.position);
            });

socket.on("set_player", function(player) {
	console.log("I am " + player);
});

login();

function login() {
	socket.emit("connected");
}

            function emit_move_box(position){
                socket.emit("move_box", {"position": position});
            }

            function move_box(positionObj) {
                var el = document.getElementById("box");
				positionObj.y += 0.5;

				var from = positionObjToPositionText(el.getAttribute("position"));
				var to = positionObjToPositionText(positionObj);

				var animationNode = positionAnimationNode(from, to);

				el.appendChild(animationNode);
            }

			function positionAnimationNode(from, to) {
				var animationNode = document.createElement("a-animation");
				animationNode.setAttribute("attribute", "position");
				animationNode.setAttribute("from", from);
				animationNode.setAttribute("to", to);
				return animationNode;
			}

			function positionObjToPositionText(positionObj) {
                var x = positionObj.x;
                var z = positionObj.z;
                var y = positionObj.y;
                return x + " " + y + " " + z + " ";
			}

            AFRAME.registerComponent('cursor-listener', {
                init: function () {
                    this.el.addEventListener("click", function (evt) {
                        emit_move_box(evt.detail.intersection.point);
                        move_box(evt.detail.intersection.point);
                    });
                }
            });
        </script>
    </head>
    <body>
        <a-scene>
            <a-camera position="0 1.6 -4" rotation="0 180 0" id="player1">
                <a-cursor></a-cursor>
				<a-box color="#998877"></a-box>
            </a-camera>
            <a-camera position="0 1.6 4" id="player2">
                <a-cursor></a-cursor>
				<a-cylinder color="#114499" ></a-cylinder>
            </a-camera>

            <a-sky color="#ECECEC"></a-sky>
            <a-plane cursor-listener position="0 0 0" rotation="-90 0 0" width="4" height="4" color="#7BC8A4"></a-plane>
        </a-scene>
    </body>
</html>
