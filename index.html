<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <title>websocket vr</title>
        <script type="text/javascript" src="/socket.io/socket.io.js"></script>
		<script src="https://aframe.io/releases/0.4.0/aframe.min.js"></script>
        <script type="text/javascript">
            var socket = io.connect();

            socket.on("changeComponent", function(data){
                if (data.name == "position") {
                    var el = document.getElementById(data.id);
                    var position = data.value.x + " " + data.value.y + " " + data.value.z + " ";
                    el.setAttribute("position", position);
                }
            });

            function changeComponent(id, name, value){
                socket.emit("changeComponent", {"id": id, "name": name, "value": value});
            }

            AFRAME.registerComponent('position_listener', {
                init: function() {
                    var id = this.el.id;
                    document.getElementById(id).addEventListener("componentchanged", function (evt){
                        changeComponent(id, evt.detail.name,evt.detail.newData);
                    });
                }
            });
        </script>
	</head>
	<body>
		<a-scene>
			<a-box id="box" position_listener position="-1 0.5 -3" rotation="0 45 0" color="#4CC3D9"></a-box>
			<a-sky color="#ECECEC"></a-sky>
		</a-scene>
    </body>
</html>
