<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <title>websocket vr</title>
        <script type="text/javascript" src="/socket.io/socket.io.js"></script>
		<script src="https://aframe.io/releases/0.4.0/aframe.min.js"></script>
        <script type="text/javascript">
            var socket = io.connect();

            socket.on("move_box", function(data){
                listen_move_box(data.position);
            });

            function listen_move_box(position) {
                move_box(position);
            }

            function emit_move_box(position){
                socket.emit("move_box", {"position": position});
            }

            function move_box(position) {
                var el = document.getElementById("box");
                var position = position.x + " " + position.y + " " + position.z + " ";
                el.setAttribute("position", position);
            }

            AFRAME.registerComponent('cursor-listener', {
                init: function () {
                    this.el.addEventListener("click", function (evt) {
                        emit_move_box(evt.detail.intersection.point);
                        listen_move_box(evt.detail.intersection.point);
                    });
                }
            });
        </script>
	</head>
	<body>
        <a-scene>
            <a-camera>
                <a-cursor></a-cursor>
            </a-camera>
			<a-box id="box" position="-1 0.5 -3" rotation="0 45 0" color="#4CC3D9"></a-box>
			<a-sky color="#ECECEC"></a-sky>
            <a-plane cursor-listener position="0 0 -4" rotation="-90 0 0" width="4" height="4" color="#7BC8A4"></a-plane>
		</a-scene>
    </body>
</html>
